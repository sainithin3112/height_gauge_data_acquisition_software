{% extends 'base.html' %}
{% block content %}
<div class="row g-3">
  <div class="col-lg-5">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-semibold">New Pellet</span>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="autoIncSwitch" checked>
          <label class="form-check-label small" for="autoIncSwitch">Auto-increment Pellet No</label>
        </div>
      </div>
      <div class="card-body">
        <div class="row g-2">
          <div class="col-12">
            <label class="form-label">O/P Product Code</label>
            <input id="lotNo" class="form-control" placeholder="e.g., ANP-28-46-251101-001">
          </div>
          <div class="col-6">
            <label class="form-label">Pellet No</label>
            <input id="pelletNo" class="form-control" placeholder="e,g., 001" value="{{ next_pellet_no }}">
          </div>
          <div class="col-6">
            <label class="form-label">Operator Name</label>
            <input id="operator" class="form-control" placeholder="e.g., John">
          </div>
          <div class="col-6">
            <label class="form-label">Unit</label>
            <select id="unit" class="form-select">
              <option value="mm" selected>mm</option>
              <option value="in">in</option>
            </select>
          </div>
          <div class="col-12">
            <label class="form-label">Notes</label>
            <input id="notes" class="form-control" placeholder="optional note...">
          </div>
        </div>

        <div class="d-flex gap-2 mt-3">
          <button id="exportExcelLot" class="btn btn-outline-success ms-auto">Export Lot (Excel)</button>
          <button id="exportPdfLot" class="btn btn-outline-dark">Export Lot (PDF)</button>
        </div>

        <hr>
        <div class="d-flex gap-2">
          <button id="startBtn" class="btn btn-primary">Start Measure</button>
          <button id="stopBtn" class="btn btn-outline-secondary" disabled>Stop Measure</button>
          <button id="clearBtn" class="btn btn-outline-danger">Clear</button>
        </div>
        <div class="mt-3 small text-muted">
          Tip: Focus will go to P1 automatically. Press the gauge button for each point. Press Enter to advance.
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between">
        <span class="fw-semibold">5-Point Thickness</span>
        <span id="statusBadge" class="badge text-bg-secondary">Idle</span>
      </div>
      <div class="card-body">
        <div class="row g-2">
          {% for i in range(1,6) %}
          <div class="col-6 col-md-4">
            <label class="form-label">P{{i}}</label>
            <input class="form-control reading" id="p{{i}}" placeholder="—" inputmode="decimal">
          </div>
          {% endfor %}
          <div class="col-12 col-md-4">
            <label class="form-label">Average</label>
            <input class="form-control" id="avg" disabled>
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Max</label>
            <input class="form-control" id="maxv" disabled>
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Min</label>
            <input class="form-control" id="minv" disabled>
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Max−Min</label>
            <input class="form-control" id="diff" disabled>
          </div>
        </div>
        <div class="mt-3 d-flex gap-2">
          <button id="saveBtn" class="btn btn-success" disabled>Save Measurement</button>
          <div id="saveMsg" class="small text-muted"></div>
        </div>
      </div>
      <!-- Hidden wedge kept for compatibility if needed -->
      <textarea id="wedge" class="form-control mt-2 d-none" placeholder="Paste here if needed"></textarea>
    </div>

    <div class="card shadow-sm mt-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-semibold">Recent Records</span>
        <button id="refreshBtn" class="btn btn-sm btn-outline-primary">Refresh</button>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm align-middle" id="tbl">
            <thead>
              <tr>
                <th>Date &AMP; Time</th><th>O/P Product <Code></Code></th><th>Pellet No</th><th>Operator</th>
                <th>P1</th><th>P2</th><th>P3</th><th>P4</th><th>P5</th>
                <th>Avg</th><th>Max</th><th>Min</th><th>Max−Min</th><th>Unit</th><th>Notes</th><th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
